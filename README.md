# Практическое задание №4. Анализ протоколов обнаружения отказов
## Проанализируйте и сравните протоколы обнаружения отказов (Gossip vs Heartbeat) для системы из 50 узлов.
### Исходные данные:
* Узлов: 50, отказов: 10%, потеря пакетов: 5%
* Gossip: interval=0.2с, fanout=3
* Heartbeat: interval=0.2с, timeout=1.0с
### Требуется:
* Заполнить сравнительную таблицу характеристик протоколов
* Рассчитать пропускную способность для Gossip (формулы предоставлены)
* Провести эксперименты с Serf Simulator (варьировать interval и количество узлов)
* Реализовать Python-функции для расчета bandwidth
### Проанализировать:
* Оптимальные параметры для системы из 100 узлов
* Условия применения каждого протокола
* Влияние потери пакетов на время конвергенции
### Формат сдачи: таблицы и расчеты, bandwidth_calculator.py, recommendations.txt

## Часть 1. Теоретический анализ

### Сравнительная таблица характеристик

| Характеристика                     | Gossip (Serf)         | Heartbeat (централизованный) |
|-----------------------------------|------------------------|------------------------------|
| Время обнаружения первого отказа  | ≈0.3 сек              | ≈0.0 сек                    |
| Время полной конвергенции         | ≈0.4 сек              | ≈0.0 сек                    |
| Масштабируемость (Big-O)          | O(log N)              | O(N)                        |
| Single point of failure           | Нет                   | Да                          |
| Устойчивость к разделению сети    | Высокая               | Низкая                      |

> Значения получены усреднением по 5–10 запускам симулятора при 50 узлах, 10% отказов, 5% потерь.

### Расчёты

- **Время конвергенции Gossip**:  
  ![T ≈ τ · logₖ(N)](https://latex.codecogs.com/svg.image?T%20%5Capprox%20%5Ctau%20%5Ccdot%20%5Clog_k%28N%29)

  Для параметров:  
  - τ = 0.2 сек  
  - k = 3  
  - N = 50  
  → ![T ≈ 0.2 · log₃(50) ≈ 0.71](https://latex.codecogs.com/svg.image?T%20%5Capprox%200.2%20%5Ccdot%20%5Clog_3%2850%29%20%5Capprox%200.71)

- **Пропускная способность Gossip (на узел)**:  
  ![BW = (3·1024·8)/0.2 = 122880 бит/с = 122.88 Кбит/с](https://latex.codecogs.com/svg.image?%5Cfrac%7B3%20%5Ccdot%201024%20%5Ccdot%208%7D%7B0.2%7D%20%3D%20122880%20%5Ctext%7B%20%5Ctext%7Bbit/s%7D%7D%20%3D%20122.88%20%5Ctext%7B%20%5Ctext%7BKbit/s%7D%7D)

- **Пропускная способность Heartbeat (на узел)**:  
  ![BW = (1024·8)/0.2 = 40960 бит/с = 40.96 Кбит/с](https://latex.codecogs.com/svg.image?%5Cfrac%7B1024%20%5Ccdot%208%7D%7B0.2%7D%20%3D%2040960%20%5Ctext%7B%20%5Ctext%7Bbit/s%7D%7D%20%3D%2040.96%20%5Ctext%7B%20%5Ctext%7BKbit/s%7D%7D)

---

## Часть 2. Эксперименты (симуляция)

### Эксперимент 1: Влияние Gossip Interval (50 узлов, 5% потерь, 10% отказов)

| Gossip Interval (сек) | Время конвергенции (сек) | Пропускная способность на узел (Кбит/с) |
|------------------------|---------------------------|------------------------------------------|
| 0.1                    | 0.2                       | 245.76                                   |
| 0.2                    | 0.4                       | 122.88                                   |
| 0.5                    | 0.7                       | 49.15                                    |
| 1.0                    | 2.0                       | 24.58                                    |

> *Пропускная способность рассчитана по формуле:*  
> (fanout · packet_size · 8) / interval

### Эксперимент 2: Влияние количества узлов (Gossip Interval=0.2 с, Fanout=3)

| Nodes | Время конвергенции (сек) | Теория: ![0.2 · log₃(N)](https://latex.codecogs.com/svg.image?0.2%20%5Ccdot%20%5Clog_3%28N%29) |
|-------|---------------------------|-----------------------------------|
| 10    | 0.1                       | 0.42                              |
| 25    | 0.2                       | 0.59                              |
| 50    | 0.4                       | 0.71                              |
| 100   | 0.6                       | 0.84                              |

**Вывод**: время конвергенции растёт медленнее линейного — подтверждается логарифмическая масштабируемость **O(log N)**.

---

## Часть 3. Влияние потери пакетов

| Packet Loss (%) | Время конвергенции (сек) |
|------------------|---------------------------|
| 0                | 0.3                       |
| 5                | 0.4                       |
| 20               | 0.5                       |

**Вывод**: даже при 20% потерях время конвергенции остаётся ниже 0.5 сек. Это связано с:
- Малым размером кластера (50 узлов)
- Высоким fanout=3
- Отсутствием сетевых задержек в симуляторе

> Все значения — **усреднённые по 5–10 запускам симулятора**.
